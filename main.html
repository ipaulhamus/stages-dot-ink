<html>
    <head>
        <meta charset="UTF-8" />
        <title>main-view</title>
        <link rel="stylesheet" href="./workspace/css/main.css" />
        <link rel="stylesheet" href="./workspace/css/settings.css" />
        <!-- Script Block for listening for setting change events -->
        <script>
            const { ipcRenderer } = require('electron');

            // Listen for settings updates from main process
            ipcRenderer.on('update-colors', (event, colorSettings) => {
                console.log('Received color update:', colorSettings);
                document.documentElement.style.setProperty('--background-color', colorSettings.backgroundColor);
                document.documentElement.style.setProperty('--primary-color', colorSettings.primaryText);
                document.documentElement.style.setProperty('--secondary-color', colorSettings.secondaryText);
                document.documentElement.style.setProperty('--shadow-color', colorSettings.shadowColor);
            });

            // Wait for DOM to load before attaching event listeners for settings functions
            window.addEventListener('DOMContentLoaded', () => {

                const mainBlock = document.getElementById('main-content');
                const settingsBlock = document.getElementById('settings-section');
                
                const settingsOpen = document.getElementById('settings-open-btn');
                const settingsClose = document.getElementById('settings-close-btn');

                if(settingsBlock && settingsOpen) {
                    console.log("Found settings open button!");
                    settingsOpen.addEventListener('click', (e) => {
                        console.log("clicked button!");
                        settingsBlock.style.display = 'block';
                        mainBlock.style.display = 'none';
                    });
                }

                if(settingsBlock && settingsClose) {
                    settingsClose.addEventListener('click', (e) => {
                        settingsBlock.style.display = 'none';
                        mainBlock.style.display = 'block';
                    });
                }
              
                const posForm = document.getElementById('pos-form');
                if (posForm) {
                    posForm.addEventListener('submit', (e) => {
                        e.preventDefault();
                        const x = parseInt(document.getElementById('x-pos').value);
                        const y = parseInt(document.getElementById('y-pos').value);
                        
                        if (!isNaN(x) && !isNaN(y)) {
                            console.log(`Sending position: x=${x}, y=${y}`);
                            ipcRenderer.send('save-window-position', { x, y });
                        } else {
                            console.error('Invalid position values');
                        }
                    });
                }

                
                const colorForm = document.getElementById('color-form');
                if (colorForm) {
                    const radioButtons = colorForm.querySelectorAll('input[type="radio"]');
                    radioButtons.forEach(radio => {
                        radio.addEventListener('change', (e) => {
                            if (e.target.checked) {
                                const themeName = e.target.value;
                                console.log(`Sending theme: ${themeName}`);
                                ipcRenderer.send('save-window-colors', themeName);
                            }
                        });
                    });
                }
            });
        </script>
    </head>
    <body>
    <div id="body">
        <div id="main-content">
            <div id="regular-battle" class="schedule-div">
                <div class="flex">
                    <img src="./workspace/images/S3_Icon_Regular_Battle.svg" class="schedule-img">
                    <h6 class="schedule-name">Regular Battle: </h6>
                    <h6 id="regular-mode" class="schedule-title" style="margin-left: 0.3rem;"></h6>
                </div>
                <p id="regular-times"></p>
                <p id="regular-maps" class="info-text-secondary"></p>
            </div>

            <div id="bankara-battle" class="schedule-div">
                <div class="flex">
                    <img src="./workspace/images/S2_Icon_Ranked_Battle.svg" class="schedule-img">
                    <h6 class="schedule-name">Anarchy Open: </h6>
                    <h6 id="bankara-mode" class="schedule-title" style="margin-left: 0.3rem;"></h6>
                </div>
                <p id="bankara-times"></p>
                <p id="bankara-maps" class="info-text-secondary"></p>
            </div>
            <div id="bankara-battle-series" class="schedule-div">
                <div class="flex">
                    <img src="./workspace/images/S2_Icon_Ranked_Battle.svg" class="schedule-img">
                    <h6 class="schedule-name">Anarchy Series: </h6>
                    <h6 id="bankara-series-mode" class="schedule-title" style="margin-left: 0.3rem;"></h6>
                </div>
                <p id="bankara-series-times"></p>
                <p id="bankara-series-maps" class="info-text-secondary"></p>
            </div>
            <div id="x-battle" class="schedule-div">
                <div class="flex">
                    <img src="./workspace/images/S3_Icon_X_Battle.svg" class="schedule-img">
                    <h6 class="schedule-name">X Battle: </h6>
                    <h6 id="x-mode" class="schedule-title" style="margin-left: 0.3rem;"></h6>
                </div>
                <p id="x-times"></p>
                <p id="x-maps" class="info-text-secondary"></p>
            </div>
            <span id="settings-open-btn" class="clickable-text">&#9881 Settings</span>
        </div>

        <div id="settings-section">
            <span id="settings-close-btn" class="clickable-text">&#10007 Close (Saves Changes)</span>
            <br />
            <hr class="page-divider">
            <p class="settings-title">Set Window Position (x, y)</p>
            <div id="window-position">
                <form id="pos-form" class="settings-form">
                    <input id="x-pos" class="settings-text" type="text" placeholder="Horizontal Position..." />
                    <input id="y-pos" class="settings-text" type="text" placeholder="Vertical Position..." />
                    <button id="window-pos-submit" class="btn-m">Change Position</button>
                </form>
            </div>
            <hr class="page-divider" />
            <p class="settings-title">Select Theme</p>
            <div id="colors">
                <form id="color-form">
                    <div class="color-option">
                        <input class="radio" type="radio" name="theme" value="default" />
                        <label for="theme">Normal</label>
                    </div>
                
                    <div class="color-option">
                        <input class="radio" type="radio" name="theme" value="ocean" />
                        <label for="theme">Ocean</label>
                    </div>
        
                    <div class="color-option">
                        <input class="radio" type="radio" name="theme" value="octo" />
                        <label for="theme">Ranked</label>
                    </div>
                
                    <div class="color-option">
                        <input class="radio" type="radio" name="theme" value="callie" />
                        <label for="theme">Callie</label>
                    </div>
                    
                    <div class="color-option">
                        <input class="radio" type="radio" name="theme" value="marie" />
                        <label for="theme">Marie</label>
                    </div>
 
                    <div class="color-option">
                        <input class="radio" type="radio" name="theme" value="sendou" />
                        <label for="theme">Sendou</label>
                    </div>
                </form>
            </div>
            <hr class="page-divider" />
            <div id="window-size">
            </div>
        </div>

        <div id="error-div">
        </div>
    </div>
    </body>
</html>